<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math-Aventure : Les √âquations du 1er Degr√© !</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(to right top, #6DD5ED, #2193B0);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            margin-top: 20px;
            box-sizing: border-box;
            position: relative;
        }

        h1 {
            color: #FF6F61;
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px #FFD180;
        }

        h2 {
            color: #4CAF50;
            font-size: 1.8em;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        p {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .level-selection button {
            background-color: #FFD180;
            color: #8B4513;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 30px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .level-selection button:hover {
            transform: scale(1.05);
            background-color: #FFC06F;
        }

        #game-area {
            display: none;
            margin-top: 30px;
            padding: 20px;
            border: 3px dashed #6DD5ED;
            border-radius: 15px;
            background-color: #E0F7FA;
        }

        #equation-display {
            font-size: 3em;
            font-weight: bold;
            color: #FF6F61;
            margin: 20px 0;
            white-space: nowrap; /* Prevent equation from wrapping */
            overflow: hidden; /* Hide overflow if it gets too long */
            text-overflow: ellipsis; /* Add ellipsis if it gets too long */
        }

        #input-area input {
            padding: 12px 18px;
            font-size: 1.5em;
            border: 2px solid #2193B0;
            border-radius: 10px;
            margin-right: 15px;
            width: 120px;
            text-align: center;
        }

        #input-area button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #input-area button:hover {
            background-color: #45a049;
        }

        #feedback, #steps-display {
            margin-top: 25px;
            font-size: 1.3em;
            padding: 15px;
            border-radius: 10px;
            min-height: 60px; /* Ensure consistent height */
        }

        #feedback.correct {
            background-color: #D4EDDA;
            color: #155724;
        }

        #feedback.wrong {
            background-color: #F8D7DA;
            color: #721C24;
        }

        #steps-display {
            background-color: #FFF3CD;
            color: #856404;
            text-align: left;
            margin-top: 20px;
            border: 1px solid #FFEBA3;
            display: none; /* Hidden by default */
        }
        
        .hint-button {
            background-color: #6DD5ED;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.2s ease;
        }

        .hint-button:hover {
            background-color: #5ACAE0;
        }

        .character-img {
            max-width: 120px;
            position: absolute;
            bottom: 20px;
            right: 20px;
            animation: bounce 2s infinite alternate;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        .confetti-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00; /* Default color */
            animation: fall 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            h2 {
                font-size: 1.5em;
            }
            p {
                font-size: 1em;
            }
            .level-selection button {
                padding: 10px 20px;
                font-size: 1.1em;
            }
            #equation-display {
                font-size: 2em;
            }
            #input-area input {
                font-size: 1.2em;
                width: 80px;
            }
            #input-area button {
                font-size: 1.2em;
                padding: 10px 20px;
            }
            .character-img {
                max-width: 80px;
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span role="img" aria-label="Rocket">üöÄ</span> Math-Aventure : Les √âquations ! <span role="img" aria-label="Star">‚≠ê</span></h1>
        <p>Bienvenue jeune explorateur ! Pr√©pare-toi √† r√©soudre des myst√®res math√©matiques et √† devenir un champion des √©quations du 1er degr√©. Choisis ton niveau et que l'aventure commence !</p>

        <div class="level-selection">
            <h2>Choisis ton D√©fi :</h2>
            <button onclick="startGame('easy')">Facile</button>
            <button onclick="startGame('medium')">Moyen</button>
            <button onclick="startGame('hard')">Difficile</button>
        </div>

        <div id="game-area">
            <h2>R√©sous l'√âquation :</h2>
            <p id="equation-display"></p>

            <div id="input-area">
                <input type="number" id="user-answer" placeholder="Ta r√©ponse X = " step="any">
                <button onclick="checkAnswer()">V√©rifier</button>
            </div>

            <p id="feedback"></p>
            <button class="hint-button" onclick="showSteps()">J'ai besoin d'aide !</button>
            <div id="steps-display"></div>

            <button class="hint-button" onclick="nextEquation()" style="margin-top: 20px; background-color: #FF6F61; display: none;" id="next-button">Prochaine √âquation</button>
            
        </div>
    </div>

    <script>
        let currentEquation = {};
        let currentLevel = '';

        const robotMascot = document.getElementById('robot-mascot');

        const equations = {
            easy: [
                { eq: "X + 5 = 10", solution: 5 },
                { eq: "X - 3 = 7", solution: 10 },
                { eq: "X + 2 = 9", solution: 7 },
                { eq: "X - 1 = 4", solution: 5 },
                { eq: "6 + X = 11", solution: 5 }
            ],
            medium: [
                { eq: "2X = 14", solution: 7 },
                { eq: "3X + 1 = 10", solution: 3 },
                { eq: "4X - 8 = 12", solution: 5 },
                { eq: "X / 2 = 6", solution: 12 },
                { eq: "5X + 7 = 22", solution: 3 }
            ],
            hard: [
                { eq: "2X + 3 = X + 7", solution: 4 },
                { eq: "5X - 10 = 2X + 5", solution: 5 },
                { eq: "3(X + 2) = 15", solution: 3 },
                { eq: "4X + 1 = 9X - 9", solution: 2 },
                { eq: "X/3 + 4 = 7", solution: 9 }
            ]
        };

        function startGame(level) {
            currentLevel = level;
            document.querySelector('.level-selection').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            generateNewEquation();
        }

        function generateNewEquation() {
            const levelEquations = equations[currentLevel];
            const randomIndex = Math.floor(Math.random() * levelEquations.length);
            currentEquation = levelEquations[randomIndex];
            document.getElementById('equation-display').textContent = currentEquation.eq;
            document.getElementById('user-answer').value = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = '';
            document.getElementById('steps-display').style.display = 'none';
            document.getElementById('next-button').style.display = 'none'; // Hide next button
            robotMascot.src = "https://image.pollinations.ai/prompt/cute%20cartoon%20robot%20happy"; // Default happy robot
        }

        function checkAnswer() {
            const userAnswer = parseFloat(document.getElementById('user-answer').value);
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');

            if (isNaN(userAnswer)) {
                feedback.textContent = "Oops ! Entre un nombre valide s'il te pla√Æt.";
                feedback.className = 'wrong';
                robotMascot.src = "https://image.pollinations.ai/prompt/cute%20cartoon%20robot%20confused"; // Confused robot
                return;
            }

            if (userAnswer === currentEquation.solution) {
                feedback.textContent = "BRAVO ! Tu as trouv√© la bonne r√©ponse ! üéâ";
                feedback.className = 'correct';
                nextButton.style.display = 'block'; // Show next button
                robotMascot.src = "https://image.pollinations.ai/prompt/cute%20cartoon%20robot%20celebrating"; // Celebrating robot
                triggerConfetti();
            } else {
                feedback.textContent = `Ce n'est pas tout √† fait √ßa. La bonne r√©ponse est ${currentEquation.solution}. Ne t'inqui√®te pas, tu peux r√©essayer ou demander de l'aide !`;
                feedback.className = 'wrong';
                robotMascot.src = "https://image.pollinations.ai/prompt/cute%20cartoon%20robot%20sad"; // Sad robot
                nextButton.style.display = 'block'; // Allow to go to next equation even if wrong
            }
        }

        function getSteps(equationObject) {
            const eq = equationObject.eq;
            const sol = equationObject.solution;
            let steps = [];

            if (eq.includes('X +')) {
                const parts = eq.split(' ');
                const numToAdd = parseFloat(parts[2]); // The number being added to X
                const result = parseFloat(parts[4]); // The result of the equation
                steps.push(`On a : ${eq}`);
                steps.push(`Pour isoler X, il faut enlever ${numToAdd} des deux c√¥t√©s de l'√©quation.`);
                steps.push(`${parts[0]} ${parts[1]} ${parts[2]} - ${numToAdd} = ${parts[4]} - ${numToAdd}`);
                steps.push(`X = ${result - numToAdd}`);
            } else if (eq.includes('X -')) {
                const parts = eq.split(' ');
                const numToSubtract = parseFloat(parts[2]); // The number being subtracted from X
                const result = parseFloat(parts[4]); // The result of the equation
                steps.push(`On a : ${eq}`);
                steps.push(`Pour isoler X, il faut ajouter ${numToSubtract} des deux c√¥t√©s de l'√©quation.`);
                steps.push(`${parts[0]} ${parts[1]} ${parts[2]} + ${numToSubtract} = ${parts[4]} + ${numToSubtract}`);
                steps.push(`X = ${result + numToSubtract}`);
            } else if (eq.includes('X =') && eq.indexOf('X =') > 0) { // For "6 + X = 11" type
                const parts = eq.split(' ');
                const numToAdd = parseFloat(parts[0]);
                const result = parseFloat(parts[4]);
                steps.push(`On a : ${eq}`);
                steps.push(`Pour isoler X, il faut enlever ${numToAdd} des deux c√¥t√©s de l'√©quation.`);
                steps.push(`${parts[0]} + X - ${numToAdd} = ${parts[4]} - ${numToAdd}`);
                steps.push(`X = ${result - numToAdd}`);
            }
            else if (eq.includes('X /')) {
                const parts = eq.split(' ');
                const divisor = parseFloat(parts[2]);
                const result = parseFloat(parts[4]);
                steps.push(`On a : ${eq}`);
                steps.push(`Pour isoler X, il faut multiplier les deux c√¥t√©s par ${divisor}.`);
                steps.push(`${parts[0]} / ${parts[2]} * ${divisor} = ${parts[4]} * ${divisor}`);
                steps.push(`X = ${result * divisor}`);
            }
             else if (eq.includes('X =')) { // Simplified case like "2X = 14"
                const parts = eq.split(' ');
                const coefficient = parseFloat(parts[0].replace('X', ''));
                const result = parseFloat(parts[2]);
                steps.push(`On a : ${eq}`);
                steps.push(`Pour trouver X, il faut diviser les deux c√¥t√©s par ${coefficient}.`);
                steps.push(`${coefficient}X / ${coefficient} = ${result} / ${coefficient}`);
                steps.push(`X = ${result / coefficient}`);
            } else if (eq.includes('X +') && eq.includes('=')) { // Covers cases like "2X + 1 = 10" or "5X + 7 = 22"
                let cleanedEq = eq.replace(/\s/g, ''); // Remove all spaces
                let parts = cleanedEq.split('=');
                let leftSide = parts[0];
                let rightSide = parseFloat(parts[1]);

                let xTerm = '';
                let constant = 0;

                if (leftSide.includes('+')) {
                    [xTerm, constant] = leftSide.split('+');
                    constant = parseFloat(constant);
                    steps.push(`On a : ${eq}`);
                    steps.push(`Premi√®re √©tape : Enlever le nombre tout seul (${constant}) des deux c√¥t√©s.`);
                    steps.push(`${xTerm} + ${constant} - ${constant} = ${rightSide} - ${constant}`);
                    rightSide -= constant;
                    steps.push(`${xTerm} = ${rightSide}`);
                } else if (leftSide.includes('-')) {
                    [xTerm, constant] = leftSide.split('-');
                    constant = parseFloat(constant); // This will be positive as it's the number *after* the minus
                    steps.push(`On a : ${eq}`);
                    steps.push(`Premi√®re √©tape : Ajouter le nombre tout seul (${constant}) des deux c√¥t√©s.`);
                    steps.push(`${xTerm} - ${constant} + ${constant} = ${rightSide} + ${constant}`);
                    rightSide += constant;
                    steps.push(`${xTerm} = ${rightSide}`);
                } else {
                    xTerm = leftSide; // No constant term, e.g., "2X"
                }
                
                let coefficient = parseFloat(xTerm.replace('X', ''));
                steps.push(`Deuxi√®me √©tape : Diviser les deux c√¥t√©s par le nombre devant le X (${coefficient}).`);
                steps.push(`${coefficient}X / ${coefficient} = ${rightSide} / ${coefficient}`);
                steps.push(`X = ${rightSide / coefficient}`);
            } else if (eq.includes('(') && eq.includes(')')) { // For "3(X + 2) = 15"
                const match = eq.match(/(\d)\(X\s*([+-])\s*(\d)\)\s*=\s*(\d+)/);
                if (match) {
                    const coefficient = parseFloat(match[1]);
                    const operator = match[2];
                    const innerConstant = parseFloat(match[3]);
                    const result = parseFloat(match[4]);

                    steps.push(`On a : ${eq}`);
                    steps.push(`Premi√®re √©tape : Diviser les deux c√¥t√©s par le nombre devant la parenth√®se (${coefficient}).`);
                    steps.push(`${coefficient}(X ${operator} ${innerConstant}) / ${coefficient} = ${result} / ${coefficient}`);
                    const newRight = result / coefficient;
                    steps.push(`X ${operator} ${innerConstant} = ${newRight}`);

                    if (operator === '+') {
                        steps.push(`Deuxi√®me √©tape : Enlever ${innerConstant} des deux c√¥t√©s.`);
                        steps.push(`X + ${innerConstant} - ${innerConstant} = ${newRight} - ${innerConstant}`);
                        steps.push(`X = ${newRight - innerConstant}`);
                    } else if (operator === '-') {
                        steps.push(`Deuxi√®me √©tape : Ajouter ${innerConstant} des deux c√¥t√©s.`);
                        steps.push(`X - ${innerConstant} + ${innerConstant} = ${newRight} + ${innerConstant}`);
                        steps.push(`X = ${newRight + innerConstant}`);
                    }
                }
            } else if (eq.includes('X +') && eq.includes('=')) { // e.g. "2X + 3 = X + 7"
                let cleanedEq = eq.replace(/\s/g, ''); // Remove all spaces
                let parts = cleanedEq.split('=');
                let leftSide = parts[0];
                let rightSide = parts[1];

                steps.push(`On a : ${eq}`);
                steps.push(`Premi√®re √©tape : Regrouper les X d'un c√¥t√© et les nombres de l'autre.`);

                // Extract X terms and constants
                let leftX = 0, rightX = 0, leftConst = 0, rightConst = 0;

                const parseSide = (side) => {
                    let currentX = 0;
                    let currentConst = 0;
                    const terms = side.match(/([+-]?\d*X)|([+-]?\d+)/g); // Matches like +2X, -5, X, -X
                    if (terms) {
                        terms.forEach(term => {
                            if (term.includes('X')) {
                                if (term === 'X') currentX += 1;
                                else if (term === '-X') currentX -= 1;
                                else currentX += parseFloat(term.replace('X', ''));
                            } else {
                                currentConst += parseFloat(term);
                            }
                        });
                    }
                    return { x: currentX, constant: currentConst };
                };
                
                let parsedLeft = parseSide(leftSide);
                let parsedRight = parseSide(rightSide);

                leftX = parsedLeft.x;
                leftConst = parsedLeft.constant;
                rightX = parsedRight.x;
                rightConst = parsedRight.constant;

                // Move X terms to left, constants to right
                steps.push(`On enl√®ve ${rightX}X des deux c√¥t√©s :`);
                steps.push(`${leftX}X - ${rightX}X + ${leftConst} = ${rightX}X - ${rightX}X + ${rightConst}`);
                leftX -= rightX;
                steps.push(`${leftX}X + ${leftConst} = ${rightConst}`);

                steps.push(`On enl√®ve ${leftConst} des deux c√¥t√©s :`);
                steps.push(`${leftX}X + ${leftConst} - ${leftConst} = ${rightConst} - ${leftConst}`);
                rightConst -= leftConst;
                steps.push(`${leftX}X = ${rightConst}`);

                steps.push(`Enfin, on divise par ${leftX} pour trouver X :`);
                steps.push(`X = ${rightConst} / ${leftX}`);
                steps.push(`X = ${rightConst / leftX}`);

            } else {
                steps.push("D√©sol√©, je ne peux pas encore donner les √©tapes pour ce type d'√©quation. Mais la solution est : X = " + sol);
            }

            return steps;
        }


        function showSteps() {
            const stepsDisplay = document.getElementById('steps-display');
            stepsDisplay.innerHTML = ''; // Clear previous steps
            const steps = getSteps(currentEquation);
            if (steps.length > 0) {
                steps.forEach((step, index) => {
                    const p = document.createElement('p');
                    p.textContent = `${index + 1}. ${step}`;
                    stepsDisplay.appendChild(p);
                });
                stepsDisplay.style.display = 'block';
            } else {
                stepsDisplay.textContent = "Je n'ai pas encore d'√©tapes d√©taill√©es pour cette √©quation, mais continue d'essayer !";
                stepsDisplay.style.display = 'block';
            }
            robotMascot.src = ""; // Teaching robot
        }

        function nextEquation() {
            generateNewEquation();
        }

        function triggerConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-animation';
            document.body.appendChild(confettiContainer);

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 75%)`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(confetti);
            }

            setTimeout(() => {
                confettiContainer.remove();
            }, 3000);
        }
    </script>
</body>
</html>
