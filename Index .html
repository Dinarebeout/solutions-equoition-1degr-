<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math-Aventure : Les √âquations !</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(to right top, #6DD5ED, #2193B0);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            margin-top: 20px;
            box-sizing: border-box;
            position: relative;
        }

        h1 {
            color: #FF6F61;
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px #FFD180;
        }

        h2 {
            color: #4CAF50;
            font-size: 1.8em;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        p {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .level-selection button {
            background-color: #FFD180;
            color: #8B4513;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 30px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .level-selection button:hover {
            transform: scale(1.05);
            background-color: #FFC06F;
        }

        #game-area {
            display: none;
            margin-top: 30px;
            padding: 20px;
            border: 3px dashed #6DD5ED;
            border-radius: 15px;
            background-color: #E0F7FA;
        }

        #equation-display {
            font-size: 3em;
            font-weight: bold;
            color: #FF6F61;
            margin: 20px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #input-area input {
            padding: 12px 18px;
            font-size: 1.5em;
            border: 2px solid #2193B0;
            border-radius: 10px;
            margin-right: 15px;
            width: 120px;
            text-align: center;
        }

        #input-area button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #input-area button:hover {
            background-color: #45a049;
        }

        #feedback, #steps-display {
            margin-top: 25px;
            font-size: 1.3em;
            padding: 15px;
            border-radius: 10px;
            min-height: 60px;
        }

        #feedback.correct {
            background-color: #D4EDDA;
            color: #155724;
        }

        #feedback.wrong {
            background-color: #F8D7DA;
            color: #721C24;
        }

        #steps-display {
            background-color: #FFF3CD;
            color: #856404;
            text-align: left;
            margin-top: 20px;
            border: 1px solid #FFEBA3;
            display: none;
        }
        
        .hint-button {
            background-color: #6DD5ED;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.2s ease;
        }

        .hint-button:hover {
            background-color: #5ACAE0;
        }

        /* Styles pour les formes g√©om√©triques */
        .character-shape {
            position: absolute;
            bottom: 20px;
            right: 20px;
            animation: bounce 2s infinite alternate;
        }

        .shape-container {
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .robot-shape {
            transition: all 0.3s ease;
        }

        /* Cercle - Forme par d√©faut (heureux) */
        .shape-circle {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #FF6F61, #FFD180);
            border-radius: 50%;
            position: relative;
        }

        .shape-circle::before, .shape-circle::after {
            content: '';
            position: absolute;
            background-color: #333;
            border-radius: 50%;
        }

        .shape-circle::before {
            width: 15px;
            height: 15px;
            top: 25px;
            left: 20px;
        }

        .shape-circle::after {
            width: 15px;
            height: 15px;
            top: 25px;
            right: 20px;
        }

        .shape-circle::before, .shape-circle::after {
            box-shadow: 0 25px 0 -5px #333;
        }

        /* Carr√© - Forme triste */
        .shape-square {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #2193B0, #6DD5ED);
            position: relative;
            transform: rotate(45deg);
        }

        .shape-square::before, .shape-square::after {
            content: '';
            position: absolute;
            background-color: #333;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .shape-square::before {
            top: 15px;
            left: 15px;
        }

        .shape-square::after {
            top: 15px;
            right: 15px;
        }

        /* Triangle - Forme confus/professeur */
        .shape-triangle {
            width: 0;
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 70px solid #4CAF50;
            position: relative;
        }

        .shape-triangle::before, .shape-triangle::after {
            content: '';
            position: absolute;
            background-color: #333;
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .shape-triangle::before {
            top: 15px;
            left: -25px;
        }

        .shape-triangle::after {
            top: 15px;
            right: -25px;
        }

        /* √âtoile - Forme c√©l√©bration */
        .shape-star {
            width: 0;
            height: 0;
            color: #FFD700;
            position: relative;
            display: block;
            margin: 20px 0;
        }

        .shape-star::before {
            content: '‚òÖ';
            font-size: 80px;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        .confetti-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            p { font-size: 1em; }
            .level-selection button { padding: 10px 20px; font-size: 1.1em; }
            #equation-display { font-size: 2em; }
            #input-area input { font-size: 1.2em; width: 80px; }
            #input-area button { font-size: 1.2em; padding: 10px 20px; }
            .character-shape { bottom: 10px; right: 10px; }
            .shape-container { width: 80px; height: 80px; }
            .shape-circle { width: 60px; height: 60px; }
            .shape-square { width: 50px; height: 50px; }
            .shape-triangle { 
                border-left: 30px solid transparent;
                border-right: 30px solid transparent;
                border-bottom: 50px solid #4CAF50;
            }
            .shape-star::before { font-size: 60px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span role="img" aria-label="Rocket">üöÄ</span> Math-Aventure : Les √âquations ! <span role="img" aria-label="Star">‚≠ê</span></h1>
        <p>Bienvenue jeune explorateur ! Pr√©pare-toi √† r√©soudre des myst√®res math√©matiques et √† devenir un champion des √©quations. Choisis ton niveau et que l'aventure commence !</p>

        <div class="level-selection">
            <h2>Choisis ton D√©fi :</h2>
            <button onclick="startGame('easy')">Facile</button>
            <button onclick="startGame('medium')">Moyen</button>
            <button onclick="startGame('hard')">Difficile</button>
        </div>

        <div id="game-area">
            <h2>R√©sous l'√âquation :</h2>
            <p id="equation-display"></p>

            <div id="input-area">
                <input type="number" id="user-answer" placeholder="X = ?" step="any">
                <button onclick="checkAnswer()">V√©rifier</button>
            </div>

            <p id="feedback"></p>
            <button class="hint-button" onclick="showSteps()">J'ai besoin d'aide !</button>
            <div id="steps-display"></div>

            <!-- Forme g√©om√©trique pour le mascotte -->
            <div class="character-shape" id="robot-mascot">
                <div class="shape-container">
                    <div class="robot-shape shape-circle" id="shape-element"></div>
                </div>
            </div>

            <button class="hint-button" onclick="nextEquation()" style="margin-top: 20px; background-color: #FF6F61; display: none;" id="next-button">Prochaine √âquation</button>
        </div>
    </div>

    <script>
        let currentEquation = {};
        let currentLevel = '';

        const shapeElement = document.getElementById('shape-element');

        const equations = {
            easy: [
                { eq: "X + 5 = 10", solution: 5 },
                { eq: "X - 3 = 7", solution: 10 },
                { eq: "X + 2 = 9", solution: 7 },
                { eq: "X - 1 = 4", solution: 5 },
                { eq: "6 + X = 11", solution: 5 }
            ],
            medium: [
                { eq: "2X = 14", solution: 7 },
                { eq: "3X + 1 = 10", solution: 3 },
                { eq: "4X - 8 = 12", solution: 5 },
                { eq: "X / 2 = 6", solution: 12 },
                { eq: "5X + 7 = 22", solution: 3 }
            ],
            hard: [
                { eq: "2X + 3 = X + 7", solution: 4 },
                { eq: "5X - 10 = 2X + 5", solution: 5 },
                { eq: "3(X + 2) = 15", solution: 3 },
                { eq: "4X + 1 = 9X - 9", solution: 2 },
                { eq: "X/3 + 4 = 7", solution: 9 }
            ]
        };

        function startGame(level) {
            currentLevel = level;
            document.querySelector('.level-selection').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            generateNewEquation();
            setShape('circle'); // Forme par d√©faut
        }

        function generateNewEquation() {
            const levelEquations = equations[currentLevel];
            const randomIndex = Math.floor(Math.random() * levelEquations.length);
            currentEquation = levelEquations[randomIndex];
            document.getElementById('equation-display').textContent = currentEquation.eq;
            document.getElementById('user-answer').value = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = '';
            document.getElementById('steps-display').style.display = 'none';
            document.getElementById('next-button').style.display = 'none';
            setShape('circle'); // Retour √† la forme heureuse
        }

        function setShape(shapeType) {
            // Retirer toutes les classes de forme
            shapeElement.className = 'robot-shape';
            
            // Ajouter la classe correspondante
            switch(shapeType) {
                case 'circle': // Heureux
                    shapeElement.classList.add('shape-circle');
                    break;
                case 'square': // Triste
                    shapeElement.classList.add('shape-square');
                    break;
                case 'triangle': // Professeur/Confus
                    shapeElement.classList.add('shape-triangle');
                    break;
                case 'star': // C√©l√©bration
                    shapeElement.classList.add('shape-star');
                    break;
                default:
                    shapeElement.classList.add('shape-circle');
            }
        }

        function checkAnswer() {
            const userAnswer = parseFloat(document.getElementById('user-answer').value);
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');

            if (isNaN(userAnswer)) {
                feedback.textContent = "Oops ! Entre un nombre valide s'il te pla√Æt.";
                feedback.className = 'wrong';
                setShape('triangle'); // Forme confus
                return;
            }

            if (userAnswer === currentEquation.solution) {
                feedback.textContent = "BRAVO ! Tu as trouv√© la bonne r√©ponse ! üéâ";
                feedback.className = 'correct';
                nextButton.style.display = 'block';
                setShape('star'); // Forme √©toile pour c√©l√©bration
                triggerConfetti();
            } else {
                feedback.textContent = `Ce n'est pas tout √† fait √ßa. La bonne r√©ponse est ${currentEquation.solution}. Ne t'inqui√®te pas, tu peux r√©essayer !`;
                feedback.className = 'wrong';
                setShape('square'); // Forme triste
                nextButton.style.display = 'block';
            }
        }

        function getSteps(equationObject) {
            const eq = equationObject.eq;
            const sol = equationObject.solution;
            let steps = [];

            // Case 1: Hardest - X on both sides
            if (eq.split('X').length - 1 > 1) { 
                let cleanedEq = eq.replace(/\s/g, ''); 
                let parts = cleanedEq.split('=');
                
                const parseSide = (side) => {
                    let x = 0, constant = 0;
                    const terms = side.match(/([+-]?)(\d*X|\d+)/g) || [];
                    terms.forEach(term => {
                        if (term.includes('X')) {
                            if (term === 'X' || term === '+X') x += 1;
                            else if (term === '-X') x -= 1;
                            else x += parseFloat(term.replace('X', ''));
                        } else {
                            constant += parseFloat(term);
                        }
                    });
                    return { x, constant };
                };

                let left = parseSide(parts[0]);
                let right = parseSide(parts[1]);

                steps.push(`On a : ${eq}`);
                steps.push(`Regroupons les X √† gauche et les nombres √† droite.`);
                
                let finalX = left.x - right.x;
                let finalConst = right.constant - left.constant;
                
                steps.push(`On d√©place les termes : ${left.x}X - ${right.x}X = ${right.constant} - ${left.constant}`);
                steps.push(`${finalX}X = ${finalConst}`);
                steps.push(`On divise par ${finalX} : X = ${finalConst} / ${finalX}`);
                steps.push(`X = ${sol}`);
                return steps;
            }
            
            // Case 2: Hard - Parentheses
            else if (eq.includes('(')) {
                const match = eq.match(/(\d+)\s*\(\s*X\s*([+-])\s*(\d+)\s*\)\s*=\s*(\d+)/);
                if (match) {
                    const [, coeff, op, innerNumStr, resultStr] = match;
                    const innerNum = parseFloat(innerNumStr);
                    const result = parseFloat(resultStr);
                    steps.push(`On a : ${eq}`);
                    steps.push(`D'abord, on divise les deux c√¥t√©s par ${coeff}.`);
                    steps.push(`X ${op} ${innerNum} = ${result} / ${coeff}`);
                    const newResult = result / parseFloat(coeff);
                    steps.push(`X ${op} ${innerNum} = ${newResult}`);
                    steps.push(`Ensuite, on isole X.`);
                    steps.push(`X = ${newResult} ${op === '+' ? '-' : '+'} ${innerNum}`);
                    steps.push(`X = ${sol}`);
                }
                return steps;
            }
            
            // Case 3: Medium - Multi-step
            else if ((eq.includes('/') || /[2-9]X/.test(eq)) && (eq.includes('+') || eq.includes('-'))) {
                let cleanedEq = eq.replace(/\s/g, '');
                let parts = cleanedEq.split('=');
                let [leftSide, rightSideNum] = [parts[0], parseFloat(parts[1])];

                steps.push(`On a : ${eq}`);

                if (leftSide.includes('+')) {
                    let [xTerm, constant] = leftSide.split('+');
                    let num = parseFloat(constant);
                    steps.push(`On enl√®ve ${num} des deux c√¥t√©s : ${xTerm} = ${rightSideNum} - ${num}`);
                    rightSideNum -= num;
                    steps.push(`${xTerm} = ${rightSideNum}`);
                } else if (leftSide.includes('-')) {
                    let [xTerm, constant] = leftSide.split('-');
                    let num = parseFloat(constant);
                    steps.push(`On ajoute ${num} des deux c√¥t√©s : ${xTerm} = ${rightSideNum} + ${num}`);
                    rightSideNum += num;
                    steps.push(`${xTerm} = ${rightSideNum}`);
                }
                
                if (leftSide.includes('/')) {
                    const divisor = parseFloat(leftSide.split('/')[1]);
                    steps.push(`On multiplie par ${divisor} : X = ${rightSideNum} * ${divisor}`);
                } else {
                    const coeff = parseFloat(leftSide.replace('X', ''));
                    steps.push(`On divise par ${coeff} : X = ${rightSideNum} / ${coeff}`);
                }
                steps.push(`X = ${sol}`);
                return steps;
            }

            // Case 4: Easy - Basic operations
            else {
                const parts = eq.split(' ');
                steps.push(`On a : ${eq}`);
                if (eq.includes('+')) {
                    const num = parts[0] === 'X' ? parseFloat(parts[2]) : parseFloat(parts[0]);
                    steps.push(`Pour isoler X, on soustrait ${num} des deux c√¥t√©s.`);
                    steps.push(`X = ${parts[4]} - ${num}`);
                } else if (eq.includes('-')) {
                    const num = parseFloat(parts[2]);
                    steps.push(`Pour isoler X, on ajoute ${num} des deux c√¥t√©s.`);
                    steps.push(`X = ${parts[4]} + ${num}`);
                } else if (/[0-9]X/.test(eq)) {
                     const coeff = parseFloat(parts[0].replace('X',''));
                     steps.push(`Pour isoler X, on divise les deux c√¥t√©s par ${coeff}.`);
                     steps.push(`X = ${parts[2]} / ${coeff}`);
                } else if (eq.includes('/')) {
                    const divisor = parseFloat(parts[2]);
                    steps.push(`Pour isoler X, on multiplie les deux c√¥t√©s par ${divisor}.`);
                    steps.push(`X = ${parts[4]} * ${divisor}`);
                }
                steps.push(`X = ${sol}`);
                return steps;
            }
        }

        function showSteps() {
            const stepsDisplay = document.getElementById('steps-display');
            stepsDisplay.innerHTML = '';
            const steps = getSteps(currentEquation);
            if (steps && steps.length > 0) {
                steps.forEach((step, index) => {
                    const p = document.createElement('p');
                    p.textContent = `${index + 1}. ${step}`;
                    stepsDisplay.appendChild(p);
                });
                stepsDisplay.style.display = 'block';
            } else {
                stepsDisplay.textContent = "Je n'ai pas d'√©tapes pour cette √©quation, mais la solution est " + currentEquation.solution;
                stepsDisplay.style.display = 'block';
            }
            setShape('triangle'); // Forme professeur
        }

        function nextEquation() {
            generateNewEquation();
        }

        function triggerConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-animation';
            document.body.appendChild(confettiContainer);

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 75%)`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(confetti);
            }

            setTimeout(() => {
                confettiContainer.remove();
            }, 3000);
        }
    </script>
</body>
</html>
